<!-- æ‹¼å†™ç»ƒä¹ é¡µé¢ -->
<view class="page-container">
  <!-- è¿›åº¦åŒºåŸŸ -->
  <view class="progress-section">
    <view class="progress-info">
      <text class="progress-text">{{currentIndex + 1}}/{{totalWords}}</text>
      <text class="progress-percentage">{{Math.round((currentIndex + 1) / totalWords * 100)}}%</text>
    </view>
    <progress percent="{{(currentIndex + 1) / totalWords * 100}}" stroke-width="4" activeColor="#4facfe" backgroundColor="#e0e0e0" />
  </view>

  <!-- å•è¯å±•ç¤ºåŒºåŸŸ -->
  <view class="word-section">
    <view class="word-card">
      <!-- å•è¯æç¤º -->
      <view class="word-hint">
        <text class="hint-label">å•è¯æç¤ºï¼š</text>
        <text class="hint-text">{{currentWord.meaning}}</text>
      </view>

      <!-- éŸ³é¢‘æ’­æ”¾ -->
      <view class="audio-section">
        <view class="audio-btn {{isPlaying ? 'playing' : ''}} {{audioLoading ? 'loading' : ''}}" bindtap="onPlayAudio">
          <text class="audio-icon" wx:if="{{!audioLoading}}">{{isPlaying ? 'â¸ï¸' : 'ğŸ”Š'}}</text>
          <view class="loading-spinner" wx:if="{{audioLoading}}"></view>
        </view>
        <view class="audio-status" wx:if="{{isPlaying || audioLoading}}">
          <text class="status-text">{{audioLoading ? 'åŠ è½½ä¸­...' : 'æ’­æ”¾ä¸­...'}}</text>
        </view>
        <view class="audio-controls">
          <view class="control-btn" bindtap="onSlowPlay">
            <text>æ…¢é€Ÿ</text>
          </view>
          <view class="control-btn" bindtap="onRepeatPlay">
            <text>é‡å¤</text>
          </view>
        </view>
      </view>

      <!-- æ‹¼å†™è¾“å…¥åŒºåŸŸ -->
      <view class="spelling-input-section">
        <view class="input-container">
          <input 
            class="spelling-input {{inputStatus}}" 
            type="text" 
            placeholder="è¯·è¾“å…¥ä½ å¬åˆ°çš„å•è¯"
            value="{{userInput}}"
            bindinput="onInputChange"
            bindconfirm="onSubmitSpelling"
            focus="{{inputFocus}}"
            maxlength="{{currentWord.word.length + 5}}"
          />
          <view class="input-length">
            <text>{{userInput.length}} / {{currentWord.word.length}}</text>
          </view>
        </view>

        <!-- å­—æ¯æç¤º -->
        <view class="letter-hints" wx:if="{{showHints}}">
          <view class="hint-header">
            <view class="hint-title">
              <text>å­—æ¯æç¤ºï¼š</text>
            </view>
            <view class="hint-close" bindtap="onHideHint">
              <text>âœ•</text>
            </view>
          </view>
          <view class="letter-grid">
            <view 
              class="letter-item {{item.revealed ? 'revealed' : ''}}" 
              wx:for="{{letterHints}}" 
              wx:key="index"
              bindtap="onRevealLetter"
              data-index="{{index}}"
            >
              <text>{{item.revealed ? item.letter : '?'}}</text>
            </view>
          </view>
          <view class="hint-tip">
            <text>ç‚¹å‡» "?" æŸ¥çœ‹å¯¹åº”ä½ç½®çš„å­—æ¯</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <view class="action-btn secondary" bindtap="onShowHint" wx:if="{{!showHints}}">
          <text>ğŸ’¡ æç¤º</text>
        </view>
        <view class="action-btn secondary" bindtap="onSkipWord">
          <text>â­ï¸ è·³è¿‡</text>
        </view>
        <view class="action-btn primary" bindtap="onSubmitSpelling">
          <text>âœ“ æäº¤</text>
        </view>
      </view>

      <!-- å¿«é€Ÿæµ‹è¯•æŒ‰é’® -->
      <view class="test-buttons" wx:if="{{showTestButtons}}">
        <view class="test-header">
          <text>ğŸ§ª å¿«é€Ÿæµ‹è¯•</text>
          <view class="test-toggle" bindtap="onToggleTestButtons">
            <text>{{showTestButtons ? 'éšè—' : 'æ˜¾ç¤º'}}</text>
          </view>
        </view>
        <view class="test-actions">
          <view class="test-btn success" bindtap="onTestCorrectAnswer">
            <text>âœ“ æµ‹è¯•æ­£ç¡®</text>
          </view>
          <view class="test-btn error" bindtap="onTestIncorrectAnswer">
            <text>âœ— æµ‹è¯•é”™è¯¯</text>
          </view>
          <view class="test-btn primary" bindtap="onTestCompletion">
            <text>ğŸ‰ æµ‹è¯•å®Œæˆ</text>
          </view>
        </view>
      </view>

      <!-- æµ‹è¯•æŒ‰é’®åˆ‡æ¢ -->
      <view class="test-toggle-btn" bindtap="onToggleTestButtons" wx:if="{{!showTestButtons}}">
        <text>ğŸ§ª æ˜¾ç¤ºæµ‹è¯•</text>
      </view>
    </view>
  </view>

  <!-- ç»“æœåé¦ˆå¼¹çª— -->
  <view class="result-overlay {{showResult ? 'show' : ''}}" catchtap="onHideResult">
    <view class="result-popup {{resultType}}" catchtap="stopPropagation">
      <!-- 1. é¡¶éƒ¨çŠ¶æ€åŒºåŸŸ - ä¼˜åŒ–é—´è·å’Œè§†è§‰å±‚æ¬¡ -->
      <view class="status-section {{resultType}}">
        <view class="status-background {{resultType}}"></view>
        <view class="status-content">
          <view class="status-icon {{resultType}}">
            <text class="icon-text">{{resultType === 'correct' ? 'âœ“' : 'âœ—'}}</text>
          </view>
          <view class="status-text">
            <text class="status-title">{{resultType === 'correct' ? 'æ‹¼å†™æ­£ç¡®ï¼' : 'æ‹¼å†™é”™è¯¯'}}</text>
            <text class="status-subtitle">{{resultType === 'correct' ? 'å¤ªæ£’äº†ï¼ç»§ç»­ä¿æŒ' : 'åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡'}}</text>
          </view>
        </view>
      </view>

      <!-- 2. å•è¯è¯¦æƒ…å¡ç‰‡ - é‡æ–°è®¾è®¡å¸ƒå±€ -->
      <view class="word-details-section">
        <view class="word-card">
          <!-- å•è¯å’ŒéŸ³æ ‡åœ¨ä¸€è¡Œæ˜¾ç¤º -->
          <view class="word-header">
            <text class="word-text">{{currentWord.word}}</text>
            <text class="word-phonetic">{{currentWord.phonetic}}</text>
          </view>
          <!-- é‡Šä¹‰åŒºåŸŸ -->
          <view class="word-meaning-card">
            <text class="word-meaning">{{currentWord.meaning}}</text>
          </view>
        </view>
      </view>

      <!-- 3. ç­”æ¡ˆå¯¹æ¯”åŒºåŸŸ - ä»…é”™è¯¯æ—¶æ˜¾ç¤ºï¼Œä¼˜åŒ–è§†è§‰å¯¹æ¯” -->
      <view class="answer-comparison-section" wx:if="{{resultType === 'incorrect'}}">
        <!-- ç”¨æˆ·ç­”æ¡ˆ -->
        <view class="user-answer-card">
          <text class="answer-label">ä½ çš„ç­”æ¡ˆ</text>
          <text class="answer-value user-answer">{{userInput}}</text>
        </view>
        <!-- æ­£ç¡®ç­”æ¡ˆ -->
        <view class="correct-answer-card">
          <text class="answer-label">æ­£ç¡®ç­”æ¡ˆ</text>
          <text class="answer-value correct-answer">{{currentWord.word}}</text>
        </view>
      </view>

      <!-- 4. é”™è¯¯åˆ†æåŒºåŸŸ - ä¼˜åŒ–ä¿¡æ¯å±•ç¤º -->
      <view class="error-analysis-section" wx:if="{{resultType === 'incorrect' && errorAnalysis.length > 0}}">
        <!-- åˆ†ææ ‡é¢˜ -->
        <view class="analysis-header">
          <view class="analysis-icon-circle">
            <text class="analysis-icon">ğŸ’¡</text>
          </view>
          <text class="analysis-title">é”™è¯¯åˆ†æ</text>
        </view>
        <!-- åˆ†æå†…å®¹ -->
        <view class="analysis-content-card">
          <view class="analysis-item" wx:for="{{errorAnalysis}}" wx:key="index">
            <text class="analysis-point">â€¢ {{item}}</text>
          </view>
        </view>
      </view>

      <!-- 5. åº•éƒ¨æ“ä½œæŒ‰é’® - é‡æ–°è®¾è®¡å¸ƒå±€å’Œæ ·å¼ -->
      <view class="action-buttons-section">
        <!-- æ¬¡è¦æŒ‰é’®ï¼šå†å¬ä¸€é -->
        <view class="action-button secondary" bindtap="onPlayResultAudio">
          <view class="button-icon-circle">
            <text class="button-icon">ğŸ”Š</text>
          </view>
          <text class="button-text">å†å¬ä¸€é</text>
        </view>
        <!-- ä¸»è¦æŒ‰é’®ï¼šä¸‹ä¸€é¢˜ -->
        <view class="action-button primary" bindtap="onNextWord">
          <view class="button-icon-circle">
            <text class="button-icon">â†’</text>
          </view>
          <text class="button-text">ä¸‹ä¸€é¢˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»ƒä¹ ç»Ÿè®¡ - ç§»é™¤ï¼Œä¸åœ¨ä¸»ç•Œé¢æ˜¾ç¤º -->
  <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨å®Œæˆç»ƒä¹ å¼¹çª—ä¸­æ˜¾ç¤º -->

  <!-- ç»ƒä¹ å®Œæˆå¼¹çª— -->
  <view class="completion-overlay {{showCompletion ? 'show' : ''}}" catchtap="onHideCompletion">
    <view class="completion-popup" catchtap="stopPropagation">
      <!-- 1. é¡¶éƒ¨çŠ¶æ€åŒºåŸŸ -->
      <view class="completion-status-section">
        <view class="completion-status-content">
          <view class="completion-status-icon">
            <text class="completion-icon-text">ğŸ†</text>
          </view>
          <view class="completion-status-text">
            <text class="completion-status-title">æ‹¼å†™ç»ƒä¹ å®Œæˆï¼</text>
            <text class="completion-status-subtitle">æ­å–œä½ å®Œæˆäº†æœ¬æ¬¡ç»ƒä¹ </text>
          </view>
        </view>
      </view>

      <!-- 2. ç»Ÿè®¡ç½‘æ ¼ - é‡æ–°è®¾è®¡å¸ƒå±€ -->
      <view class="practice-stats-section">
        <view class="stats-grid">
          <view class="stat-item correct-stat">
            <text class="stat-value">{{practiceStats.correct}}</text>
            <text class="stat-label">æ­£ç¡®æ•°</text>
          </view>
          <view class="stat-item incorrect-stat">
            <text class="stat-value">{{practiceStats.incorrect}}</text>
            <text class="stat-label">é”™è¯¯æ•°</text>
          </view>
          <view class="stat-item accuracy-stat">
            <text class="stat-value">{{practiceStats.accuracy}}%</text>
            <text class="stat-label">å‡†ç¡®ç‡</text>
          </view>
          <view class="stat-item time-stat">
            <text class="stat-value">{{practiceStats.timeUsed}}</text>
            <text class="stat-label">ç”¨æ—¶(åˆ†)</text>
          </view>
        </view>
      </view>

      <!-- 3. æˆå°±å¾½ç« åŒºåŸŸ -->
      <view class="achievement-section" wx:if="{{practiceStats.achievements.length > 0}}">
        <view class="achievement-header">
          <view class="achievement-icon-circle">
            <text class="achievement-icon">ğŸ†</text>
          </view>
          <text class="achievement-title">è·å¾—æˆå°±</text>
        </view>
        <view class="achievement-badges-card">
          <view class="achievement-badge" wx:for="{{practiceStats.achievements}}" wx:key="index">
            <view class="badge-icon-circle">
              <text class="badge-icon">{{item.icon}}</text>
            </view>
            <text class="badge-name">{{item.name}}</text>
          </view>
        </view>
      </view>

      <!-- 4. åº•éƒ¨æ“ä½œæŒ‰é’® -->
      <view class="completion-action-buttons-section">
        <view class="completion-action-button secondary" bindtap="onRestartPractice">
          <text class="completion-button-text">ğŸ”„ é‡æ–°å¼€å§‹</text>
        </view>
        <view class="completion-action-button primary" bindtap="onConfirmCompletion">
          <text class="completion-button-text">âœ” ç¡®è®¤</text>
        </view>
        <view class="completion-action-button primary" bindtap="onBackToHome">
          <text class="completion-button-text">â† è¿”å›</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¸®åŠ©è¯´æ˜å¼¹çª— -->
  <view class="help-overlay {{showHelp ? 'show' : ''}}" bindtap="onHideHelp">
    <view class="help-content" catchtap="stopPropagation">
      <view class="help-header">
        <text class="help-title">æ‹¼å†™ç»ƒä¹ è¯´æ˜</text>
        <view class="help-close-icon" bindtap="onHideHelp"><text>Ã—</text></view>
      </view>
      <view class="help-body">
        <view class="help-item">
          <text class="help-step">1.</text>
          <text class="help-text">ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¬å•è¯å‘éŸ³</text>
        </view>
        <view class="help-item">
          <text class="help-step">2.</text>
          <text class="help-text">æ ¹æ®å‘éŸ³å’Œé‡Šä¹‰æç¤ºæ‹¼å†™å•è¯</text>
        </view>
        <view class="help-item">
          <text class="help-step">3.</text>
          <text class="help-text">å¯ä»¥ä½¿ç”¨æ…¢é€Ÿæ’­æ”¾å’Œé‡å¤æ’­æ”¾</text>
        </view>
        <view class="help-item">
          <text class="help-step">4.</text>
          <text class="help-text">éœ€è¦å¸®åŠ©æ—¶å¯ä»¥ç‚¹å‡»æç¤ºæŒ‰é’®</text>
        </view>
        <view class="help-item">
          <text class="help-step">5.</text>
          <text class="help-text">å®Œæˆæ‹¼å†™åç‚¹å‡»æäº¤æŸ¥çœ‹ç»“æœ</text>
        </view>
        <view class="help-actions">
          <view class="help-confirm-btn" bindtap="onHideHelp"><text>æˆ‘çŸ¥é“äº†</text></view>
        </view>
      </view>
    </view>
  </view>
</view>