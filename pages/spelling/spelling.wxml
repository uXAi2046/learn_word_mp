<!-- 拼写练习页面 -->
<view class="page-container">
  <!-- 进度区域 -->
  <view class="progress-section">
    <view class="progress-info">
      <text class="progress-text">{{currentIndex + 1}}/{{totalWords}}</text>
      <text class="progress-percentage">{{Math.round((currentIndex + 1) / totalWords * 100)}}%</text>
    </view>
    <progress percent="{{(currentIndex + 1) / totalWords * 100}}" stroke-width="4" activeColor="#4facfe" backgroundColor="#e0e0e0" />
  </view>

  <!-- 单词展示区域 -->
  <view class="word-section">
    <view class="word-card">
      <!-- 单词提示 -->
      <view class="word-hint">
        <text class="hint-label">单词提示：</text>
        <text class="hint-text">{{currentWord.meaning}}</text>
      </view>

      <!-- 音频播放 -->
      <view class="audio-section">
        <view class="audio-btn {{isPlaying ? 'playing' : ''}} {{audioLoading ? 'loading' : ''}}" bindtap="onPlayAudio">
          <text class="audio-icon" wx:if="{{!audioLoading}}">{{isPlaying ? '⏸️' : '🔊'}}</text>
          <view class="loading-spinner" wx:if="{{audioLoading}}"></view>
        </view>
        <view class="audio-status" wx:if="{{isPlaying || audioLoading}}">
          <text class="status-text">{{audioLoading ? '加载中...' : '播放中...'}}</text>
        </view>
        <view class="audio-controls">
          <view class="control-btn" bindtap="onSlowPlay">
            <text>慢速</text>
          </view>
          <view class="control-btn" bindtap="onRepeatPlay">
            <text>重复</text>
          </view>
        </view>
      </view>

      <!-- 拼写输入区域 -->
      <view class="spelling-input-section">
        <view class="input-container">
          <input 
            class="spelling-input {{inputStatus}}" 
            type="text" 
            placeholder="请输入你听到的单词"
            value="{{userInput}}"
            bindinput="onInputChange"
            bindconfirm="onSubmitSpelling"
            focus="{{inputFocus}}"
            maxlength="{{currentWord.word.length + 5}}"
          />
          <view class="input-length">
            <text>{{userInput.length}} / {{currentWord.word.length}}</text>
          </view>
        </view>

        <!-- 字母提示 -->
        <view class="letter-hints" wx:if="{{showHints}}">
          <view class="hint-header">
            <view class="hint-title">
              <text>字母提示：</text>
            </view>
            <view class="hint-close" bindtap="onHideHint">
              <text>✕</text>
            </view>
          </view>
          <view class="letter-grid">
            <view 
              class="letter-item {{item.revealed ? 'revealed' : ''}}" 
              wx:for="{{letterHints}}" 
              wx:key="index"
              bindtap="onRevealLetter"
              data-index="{{index}}"
            >
              <text>{{item.revealed ? item.letter : '?'}}</text>
            </view>
          </view>
          <view class="hint-tip">
            <text>点击 "?" 查看对应位置的字母</text>
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-buttons">
        <view class="action-btn secondary" bindtap="onShowHint" wx:if="{{!showHints}}">
          <text>💡 提示</text>
        </view>
        <view class="action-btn secondary" bindtap="onSkipWord">
          <text>⏭️ 跳过</text>
        </view>
        <view class="action-btn primary" bindtap="onSubmitSpelling">
          <text>✓ 提交</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 结果反馈弹窗 -->
  <view class="result-overlay {{showResult ? 'show' : ''}}" catchtap="onHideResult">
    <view class="result-popup {{resultType}}" catchtap="stopPropagation">
      <!-- 结果状态 -->
      <view class="result-status {{resultType}}">
        <view class="status-icon {{resultType}}">
          <text class="icon-text">{{resultType === 'correct' ? '✓' : '✗'}}</text>
        </view>
        <view class="status-text">
          <text class="status-title">{{resultType === 'correct' ? '拼写正确！' : '拼写错误'}}</text>
          <text class="status-subtitle" wx:if="{{resultType === 'correct'}}">太棒了！继续保持</text>
          <text class="status-subtitle" wx:if="{{resultType === 'incorrect'}}">别灰心，再试一次</text>
        </view>
      </view>

      <!-- 答案详情 -->
      <view class="answer-details">
        <view class="answer-card">
          <view class="word-display">
            <text class="word-text">{{currentWord.word}}</text>
            <text class="word-phonetic">{{currentWord.phonetic}}</text>
          </view>
          <view class="word-meaning">
            <text>{{currentWord.meaning}}</text>
          </view>
        </view>

        <!-- 用户答案对比 (仅错误时显示) -->
        <view class="answer-comparison" wx:if="{{resultType === 'incorrect'}}">
          <view class="comparison-item user-answer-item">
            <text class="comparison-label">你的答案</text>
            <text class="comparison-value user-answer">{{userInput}}</text>
          </view>
          <view class="comparison-item correct-answer-item">
            <text class="comparison-label">正确答案</text>
            <text class="comparison-value correct-answer">{{currentWord.word}}</text>
          </view>
        </view>
      </view>

      <!-- 错误分析 (仅错误时显示) -->
      <view class="error-analysis" wx:if="{{resultType === 'incorrect' && errorAnalysis.length > 0}}">
        <view class="analysis-header">
          <view class="analysis-icon">💡</view>
          <text class="analysis-title">错误分析</text>
        </view>
        <view class="analysis-content">
          <view class="analysis-item" wx:for="{{errorAnalysis}}" wx:key="index">
            <view class="analysis-point">
              <text class="point-icon">•</text>
              <text class="point-text">{{item}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="result-actions">
        <view class="action-button secondary" bindtap="onPlayResultAudio">
          <view class="button-icon audio-icon">
            <text>🔊</text>
          </view>
          <text class="button-text">再听一遍</text>
        </view>
        <view class="action-button primary" bindtap="onNextWord">
          <view class="button-icon next-icon">
            <text>→</text>
          </view>
          <text class="button-text">下一题</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 练习统计 - 移除，不在主界面显示 -->
  <!-- 统计信息将在完成练习弹窗中显示 -->

  <!-- 练习完成弹窗 -->
  <view class="complete-overlay {{showComplete ? 'show' : ''}}" catchtap="onHideComplete">
    <view class="complete-popup" catchtap="stopPropagation">
      <!-- 完成状态 -->
      <view class="complete-status">
        <view class="complete-icon success">
          <text class="icon-text">🏆</text>
        </view>
        <view class="complete-text">
          <text class="complete-title">拼写练习完成！</text>
          <text class="complete-subtitle">恭喜你完成了本次练习</text>
        </view>
      </view>

      <!-- 练习统计 -->
      <view class="practice-stats">
        <view class="stats-header">
          <view class="stats-icon">📊</view>
          <text class="stats-title">练习统计</text>
        </view>
        <view class="stats-grid">
          <view class="stat-item correct">
            <view class="stat-icon">✅</view>
            <view class="stat-number">{{stats.correct}}</view>
            <view class="stat-label">正确数</view>
          </view>
          <view class="stat-item incorrect">
            <view class="stat-icon">❌</view>
            <view class="stat-number">{{stats.incorrect}}</view>
            <view class="stat-label">错误数</view>
          </view>
          <view class="stat-item accuracy">
            <view class="stat-icon">🎯</view>
            <view class="stat-number">{{stats.accuracy}}%</view>
            <view class="stat-label">准确率</view>
          </view>
          <view class="stat-item time">
            <view class="stat-icon">⏱️</view>
            <view class="stat-number">{{practiceTime}}</view>
            <view class="stat-label">用时(分钟)</view>
          </view>
        </view>
      </view>

      <!-- 成就徽章 -->
      <view class="achievement-section" wx:if="{{achievements.length > 0}}">
        <view class="achievement-header">
          <view class="achievement-header-icon">🏅</view>
          <text class="achievement-title">获得成就</text>
        </view>
        <view class="achievement-grid">
          <view class="achievement-badge" wx:for="{{achievements}}" wx:key="index">
            <view class="badge-icon">
              <text class="badge-emoji">{{item.icon}}</text>
            </view>
            <view class="badge-name">
              <text>{{item.name}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="complete-actions">
        <view class="complete-button secondary" bindtap="onRestart">
          <view class="button-icon restart-icon">
            <text>🔄</text>
          </view>
          <text class="button-text">重新开始</text>
        </view>
        <view class="complete-button primary" bindtap="onBackToDetail">
          <view class="button-icon back-icon">
            <text>←</text>
          </view>
          <text class="button-text">返回</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 帮助说明弹窗 -->
  <view class="help-overlay {{showHelp ? 'show' : ''}}" bindtap="onHideHelp">
    <view class="help-content" catchtap="stopPropagation">
      <view class="help-header">
        <text class="help-title">拼写练习说明</text>
        <text class="help-close" bindtap="onHideHelp">×</text>
      </view>
      <view class="help-body">
        <view class="help-item">
          <text class="help-step">1.</text>
          <text class="help-text">点击播放按钮听单词发音</text>
        </view>
        <view class="help-item">
          <text class="help-step">2.</text>
          <text class="help-text">根据发音和释义提示拼写单词</text>
        </view>
        <view class="help-item">
          <text class="help-step">3.</text>
          <text class="help-text">可以使用慢速播放和重复播放</text>
        </view>
        <view class="help-item">
          <text class="help-step">4.</text>
          <text class="help-text">需要帮助时可以点击提示按钮</text>
        </view>
        <view class="help-item">
          <text class="help-step">5.</text>
          <text class="help-text">完成拼写后点击提交查看结果</text>
        </view>
      </view>
    </view>
  </view>
</view>