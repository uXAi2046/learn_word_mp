<!-- æ‹¼å†™ç»ƒä¹ é¡µé¢ -->
<view class="page-container">
  <!-- è¿›åº¦åŒºåŸŸ -->
  <view class="progress-section">
    <view class="progress-info">
      <text class="progress-text">{{currentIndex + 1}}/{{totalWords}}</text>
      <text class="progress-percentage">{{Math.round((currentIndex + 1) / totalWords * 100)}}%</text>
    </view>
    <progress percent="{{(currentIndex + 1) / totalWords * 100}}" stroke-width="4" activeColor="#4facfe" backgroundColor="#e0e0e0" />
  </view>

  <!-- å•è¯å±•ç¤ºåŒºåŸŸ -->
  <view class="word-section">
    <view class="word-card">
      <!-- å•è¯æç¤º -->
      <view class="word-hint">
        <text class="hint-label">å•è¯æç¤ºï¼š</text>
        <text class="hint-text">{{currentWord.meaning}}</text>
      </view>

      <!-- éŸ³é¢‘æ’­æ”¾ -->
      <view class="audio-section">
        <view class="audio-btn {{isPlaying ? 'playing' : ''}} {{audioLoading ? 'loading' : ''}}" bindtap="onPlayAudio">
          <text class="audio-icon" wx:if="{{!audioLoading}}">{{isPlaying ? 'â¸ï¸' : 'ğŸ”Š'}}</text>
          <view class="loading-spinner" wx:if="{{audioLoading}}"></view>
        </view>
        <view class="audio-status" wx:if="{{isPlaying || audioLoading}}">
          <text class="status-text">{{audioLoading ? 'åŠ è½½ä¸­...' : 'æ’­æ”¾ä¸­...'}}</text>
        </view>
        <view class="audio-controls">
          <view class="control-btn" bindtap="onSlowPlay">
            <text>æ…¢é€Ÿ</text>
          </view>
          <view class="control-btn" bindtap="onRepeatPlay">
            <text>é‡å¤</text>
          </view>
        </view>
      </view>

      <!-- æ‹¼å†™è¾“å…¥åŒºåŸŸ -->
      <view class="spelling-input-section">
        <view class="input-container">
          <input 
            class="spelling-input {{inputStatus}}" 
            type="text" 
            placeholder="è¯·è¾“å…¥ä½ å¬åˆ°çš„å•è¯"
            value="{{userInput}}"
            bindinput="onInputChange"
            bindconfirm="onSubmitSpelling"
            focus="{{inputFocus}}"
            maxlength="{{currentWord.word.length + 5}}"
          />
          <view class="input-length">
            <text>{{userInput.length}} / {{currentWord.word.length}}</text>
          </view>
        </view>

        <!-- å­—æ¯æç¤º -->
        <view class="letter-hints" wx:if="{{showHints}}">
          <view class="hint-header">
            <view class="hint-title">
              <text>å­—æ¯æç¤ºï¼š</text>
            </view>
            <view class="hint-close" bindtap="onHideHint">
              <text>âœ•</text>
            </view>
          </view>
          <view class="letter-grid">
            <view 
              class="letter-item {{item.revealed ? 'revealed' : ''}}" 
              wx:for="{{letterHints}}" 
              wx:key="index"
              bindtap="onRevealLetter"
              data-index="{{index}}"
            >
              <text>{{item.revealed ? item.letter : '?'}}</text>
            </view>
          </view>
          <view class="hint-tip">
            <text>ç‚¹å‡» "?" æŸ¥çœ‹å¯¹åº”ä½ç½®çš„å­—æ¯</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <view class="action-btn secondary" bindtap="onShowHint" wx:if="{{!showHints}}">
          <text>ğŸ’¡ æç¤º</text>
        </view>
        <view class="action-btn secondary" bindtap="onSkipWord">
          <text>â­ï¸ è·³è¿‡</text>
        </view>
        <view class="action-btn primary" bindtap="onSubmitSpelling">
          <text>âœ“ æäº¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»“æœåé¦ˆå¼¹çª— -->
  <view class="result-overlay {{showResult ? 'show' : ''}}" catchtap="onHideResult">
    <view class="result-popup {{resultType}}" catchtap="stopPropagation">
      <!-- ç»“æœçŠ¶æ€ -->
      <view class="result-status {{resultType}}">
        <view class="status-icon {{resultType}}">
          <text class="icon-text">{{resultType === 'correct' ? 'âœ“' : 'âœ—'}}</text>
        </view>
        <view class="status-text">
          <text class="status-title">{{resultType === 'correct' ? 'æ‹¼å†™æ­£ç¡®ï¼' : 'æ‹¼å†™é”™è¯¯'}}</text>
          <text class="status-subtitle" wx:if="{{resultType === 'correct'}}">å¤ªæ£’äº†ï¼ç»§ç»­ä¿æŒ</text>
          <text class="status-subtitle" wx:if="{{resultType === 'incorrect'}}">åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡</text>
        </view>
      </view>

      <!-- ç­”æ¡ˆè¯¦æƒ… -->
      <view class="answer-details">
        <view class="answer-card">
          <view class="word-display">
            <text class="word-text">{{currentWord.word}}</text>
            <text class="word-phonetic">{{currentWord.phonetic}}</text>
          </view>
          <view class="word-meaning">
            <text>{{currentWord.meaning}}</text>
          </view>
        </view>

        <!-- ç”¨æˆ·ç­”æ¡ˆå¯¹æ¯” (ä»…é”™è¯¯æ—¶æ˜¾ç¤º) -->
        <view class="answer-comparison" wx:if="{{resultType === 'incorrect'}}">
          <view class="comparison-item user-answer-item">
            <text class="comparison-label">ä½ çš„ç­”æ¡ˆ</text>
            <text class="comparison-value user-answer">{{userInput}}</text>
          </view>
          <view class="comparison-item correct-answer-item">
            <text class="comparison-label">æ­£ç¡®ç­”æ¡ˆ</text>
            <text class="comparison-value correct-answer">{{currentWord.word}}</text>
          </view>
        </view>
      </view>

      <!-- é”™è¯¯åˆ†æ (ä»…é”™è¯¯æ—¶æ˜¾ç¤º) -->
      <view class="error-analysis" wx:if="{{resultType === 'incorrect' && errorAnalysis.length > 0}}">
        <view class="analysis-header">
          <view class="analysis-icon">ğŸ’¡</view>
          <text class="analysis-title">é”™è¯¯åˆ†æ</text>
        </view>
        <view class="analysis-content">
          <view class="analysis-item" wx:for="{{errorAnalysis}}" wx:key="index">
            <view class="analysis-point">
              <text class="point-icon">â€¢</text>
              <text class="point-text">{{item}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="result-actions">
        <view class="action-button secondary" bindtap="onPlayResultAudio">
          <view class="button-icon audio-icon">
            <text>ğŸ”Š</text>
          </view>
          <text class="button-text">å†å¬ä¸€é</text>
        </view>
        <view class="action-button primary" bindtap="onNextWord">
          <view class="button-icon next-icon">
            <text>â†’</text>
          </view>
          <text class="button-text">ä¸‹ä¸€é¢˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»ƒä¹ ç»Ÿè®¡ - ç§»é™¤ï¼Œä¸åœ¨ä¸»ç•Œé¢æ˜¾ç¤º -->
  <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨å®Œæˆç»ƒä¹ å¼¹çª—ä¸­æ˜¾ç¤º -->

  <!-- ç»ƒä¹ å®Œæˆå¼¹çª— -->
  <view class="complete-overlay {{showComplete ? 'show' : ''}}" catchtap="onHideComplete">
    <view class="complete-popup" catchtap="stopPropagation">
      <!-- å®ŒæˆçŠ¶æ€ -->
      <view class="complete-status">
        <view class="complete-icon success">
          <text class="icon-text">ğŸ†</text>
        </view>
        <view class="complete-text">
          <text class="complete-title">æ‹¼å†™ç»ƒä¹ å®Œæˆï¼</text>
          <text class="complete-subtitle">æ­å–œä½ å®Œæˆäº†æœ¬æ¬¡ç»ƒä¹ </text>
        </view>
      </view>

      <!-- ç»ƒä¹ ç»Ÿè®¡ -->
      <view class="practice-stats">
        <view class="stats-header">
          <view class="stats-icon">ğŸ“Š</view>
          <text class="stats-title">ç»ƒä¹ ç»Ÿè®¡</text>
        </view>
        <view class="stats-grid">
          <view class="stat-item correct">
            <view class="stat-icon">âœ…</view>
            <view class="stat-number">{{stats.correct}}</view>
            <view class="stat-label">æ­£ç¡®æ•°</view>
          </view>
          <view class="stat-item incorrect">
            <view class="stat-icon">âŒ</view>
            <view class="stat-number">{{stats.incorrect}}</view>
            <view class="stat-label">é”™è¯¯æ•°</view>
          </view>
          <view class="stat-item accuracy">
            <view class="stat-icon">ğŸ¯</view>
            <view class="stat-number">{{stats.accuracy}}%</view>
            <view class="stat-label">å‡†ç¡®ç‡</view>
          </view>
          <view class="stat-item time">
            <view class="stat-icon">â±ï¸</view>
            <view class="stat-number">{{practiceTime}}</view>
            <view class="stat-label">ç”¨æ—¶(åˆ†é’Ÿ)</view>
          </view>
        </view>
      </view>

      <!-- æˆå°±å¾½ç«  -->
      <view class="achievement-section" wx:if="{{achievements.length > 0}}">
        <view class="achievement-header">
          <view class="achievement-header-icon">ğŸ…</view>
          <text class="achievement-title">è·å¾—æˆå°±</text>
        </view>
        <view class="achievement-grid">
          <view class="achievement-badge" wx:for="{{achievements}}" wx:key="index">
            <view class="badge-icon">
              <text class="badge-emoji">{{item.icon}}</text>
            </view>
            <view class="badge-name">
              <text>{{item.name}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="complete-actions">
        <view class="complete-button secondary" bindtap="onRestart">
          <view class="button-icon restart-icon">
            <text>ğŸ”„</text>
          </view>
          <text class="button-text">é‡æ–°å¼€å§‹</text>
        </view>
        <view class="complete-button primary" bindtap="onBackToDetail">
          <view class="button-icon back-icon">
            <text>â†</text>
          </view>
          <text class="button-text">è¿”å›</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¸®åŠ©è¯´æ˜å¼¹çª— -->
  <view class="help-overlay {{showHelp ? 'show' : ''}}" bindtap="onHideHelp">
    <view class="help-content" catchtap="stopPropagation">
      <view class="help-header">
        <text class="help-title">æ‹¼å†™ç»ƒä¹ è¯´æ˜</text>
        <text class="help-close" bindtap="onHideHelp">Ã—</text>
      </view>
      <view class="help-body">
        <view class="help-item">
          <text class="help-step">1.</text>
          <text class="help-text">ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¬å•è¯å‘éŸ³</text>
        </view>
        <view class="help-item">
          <text class="help-step">2.</text>
          <text class="help-text">æ ¹æ®å‘éŸ³å’Œé‡Šä¹‰æç¤ºæ‹¼å†™å•è¯</text>
        </view>
        <view class="help-item">
          <text class="help-step">3.</text>
          <text class="help-text">å¯ä»¥ä½¿ç”¨æ…¢é€Ÿæ’­æ”¾å’Œé‡å¤æ’­æ”¾</text>
        </view>
        <view class="help-item">
          <text class="help-step">4.</text>
          <text class="help-text">éœ€è¦å¸®åŠ©æ—¶å¯ä»¥ç‚¹å‡»æç¤ºæŒ‰é’®</text>
        </view>
        <view class="help-item">
          <text class="help-step">5.</text>
          <text class="help-text">å®Œæˆæ‹¼å†™åç‚¹å‡»æäº¤æŸ¥çœ‹ç»“æœ</text>
        </view>
      </view>
    </view>
  </view>
</view>