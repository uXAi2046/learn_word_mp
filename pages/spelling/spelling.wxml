<!-- 拼写练习页面 -->
<view class="page-container">
  <!-- 进度区域 -->
  <view class="progress-section">
    <view class="progress-info">
      <text class="progress-text">{{currentIndex + 1}}/{{totalWords}}</text>
      <text class="progress-percentage">{{Math.round((currentIndex + 1) / totalWords * 100)}}%</text>
    </view>
    <progress percent="{{(currentIndex + 1) / totalWords * 100}}" stroke-width="4" activeColor="#4facfe" backgroundColor="#e0e0e0" />
  </view>

  <!-- 单词展示区域 -->
  <view class="word-section">
    <view class="word-card">
      <!-- 单词提示 -->
      <view class="word-hint">
        <text class="hint-label">单词提示：</text>
        <text class="hint-text">{{currentWord.meaning}}</text>
      </view>

      <!-- 音频播放 -->
      <view class="audio-section">
        <view class="audio-btn {{isPlaying ? 'playing' : ''}} {{audioLoading ? 'loading' : ''}}" bindtap="onPlayAudio">
          <text class="audio-icon" wx:if="{{!audioLoading}}">{{isPlaying ? '⏸️' : '🔊'}}</text>
          <view class="loading-spinner" wx:if="{{audioLoading}}"></view>
        </view>
        <view class="audio-status" wx:if="{{isPlaying || audioLoading}}">
          <text class="status-text">{{audioLoading ? '加载中...' : '播放中...'}}</text>
        </view>
        <view class="audio-controls">
          <view class="control-btn" bindtap="onSlowPlay">
            <text>慢速</text>
          </view>
          <view class="control-btn" bindtap="onRepeatPlay">
            <text>重复</text>
          </view>
        </view>
      </view>

      <!-- 拼写输入区域 -->
      <view class="spelling-input-section">
        <view class="input-container">
          <input 
            class="spelling-input {{inputStatus}}" 
            type="text" 
            placeholder="请输入你听到的单词"
            value="{{userInput}}"
            bindinput="onInputChange"
            bindconfirm="onSubmitSpelling"
            focus="{{inputFocus}}"
            maxlength="{{currentWord.word.length + 5}}"
          />
          <view class="input-length">
            <text>{{userInput.length}} / {{currentWord.word.length}}</text>
          </view>
        </view>

        <!-- 字母提示 -->
        <view class="letter-hints" wx:if="{{showHints}}">
          <view class="hint-header">
            <view class="hint-title">
              <text>字母提示：</text>
            </view>
            <view class="hint-close" bindtap="onHideHint">
              <text>✕</text>
            </view>
          </view>
          <view class="letter-grid">
            <view 
              class="letter-item {{item.revealed ? 'revealed' : ''}}" 
              wx:for="{{letterHints}}" 
              wx:key="index"
              bindtap="onRevealLetter"
              data-index="{{index}}"
            >
              <text>{{item.revealed ? item.letter : '?'}}</text>
            </view>
          </view>
          <view class="hint-tip">
            <text>点击 "?" 查看对应位置的字母</text>
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-buttons">
        <view class="action-btn secondary" bindtap="onShowHint" wx:if="{{!showHints}}">
          <text>💡 提示</text>
        </view>
        <view class="action-btn secondary" bindtap="onSkipWord">
          <text>⏭️ 跳过</text>
        </view>
        <view class="action-btn primary" bindtap="onSubmitSpelling">
          <text>✓ 提交</text>
        </view>
      </view>

      <!-- 快速测试按钮 -->
      <view class="test-buttons" wx:if="{{showTestButtons}}">
        <view class="test-header">
          <text>🧪 快速测试</text>
          <view class="test-toggle" bindtap="onToggleTestButtons">
            <text>{{showTestButtons ? '隐藏' : '显示'}}</text>
          </view>
        </view>
        <view class="test-actions">
          <view class="test-btn success" bindtap="onTestCorrectAnswer">
            <text>✓ 测试正确</text>
          </view>
          <view class="test-btn error" bindtap="onTestIncorrectAnswer">
            <text>✗ 测试错误</text>
          </view>
          <view class="test-btn primary" bindtap="onTestCompletion">
            <text>🎉 测试完成</text>
          </view>
        </view>
      </view>

      <!-- 测试按钮切换 -->
      <view class="test-toggle-btn" bindtap="onToggleTestButtons" wx:if="{{!showTestButtons}}">
        <text>🧪 显示测试</text>
      </view>
    </view>
  </view>

  <!-- 结果反馈弹窗 -->
  <view class="result-overlay {{showResult ? 'show' : ''}}" catchtap="onHideResult">
    <view class="result-popup {{resultType}}" catchtap="stopPropagation">
      <!-- 1. 顶部状态区域 - 优化间距和视觉层次 -->
      <view class="status-section {{resultType}}">
        <view class="status-background {{resultType}}"></view>
        <view class="status-content">
          <view class="status-icon {{resultType}}">
            <text class="icon-text">{{resultType === 'correct' ? '✓' : '✗'}}</text>
          </view>
          <view class="status-text">
            <text class="status-title">{{resultType === 'correct' ? '拼写正确！' : '拼写错误'}}</text>
            <text class="status-subtitle">{{resultType === 'correct' ? '太棒了！继续保持' : '别灰心，再试一次'}}</text>
          </view>
        </view>
      </view>

      <!-- 2. 单词详情卡片 - 重新设计布局 -->
      <view class="word-details-section">
        <view class="word-card">
          <!-- 单词和音标在一行显示 -->
          <view class="word-header">
            <text class="word-text">{{currentWord.word}}</text>
            <text class="word-phonetic">{{currentWord.phonetic}}</text>
          </view>
          <!-- 释义区域 -->
          <view class="word-meaning-card">
            <text class="word-meaning">{{currentWord.meaning}}</text>
          </view>
        </view>
      </view>

      <!-- 3. 答案对比区域 - 仅错误时显示，优化视觉对比 -->
      <view class="answer-comparison-section" wx:if="{{resultType === 'incorrect'}}">
        <!-- 用户答案 -->
        <view class="user-answer-card">
          <text class="answer-label">你的答案</text>
          <text class="answer-value user-answer">{{userInput}}</text>
        </view>
        <!-- 正确答案 -->
        <view class="correct-answer-card">
          <text class="answer-label">正确答案</text>
          <text class="answer-value correct-answer">{{currentWord.word}}</text>
        </view>
      </view>

      <!-- 4. 错误分析区域 - 优化信息展示 -->
      <view class="error-analysis-section" wx:if="{{resultType === 'incorrect' && errorAnalysis.length > 0}}">
        <!-- 分析标题 -->
        <view class="analysis-header">
          <view class="analysis-icon-circle">
            <text class="analysis-icon">💡</text>
          </view>
          <text class="analysis-title">错误分析</text>
        </view>
        <!-- 分析内容 -->
        <view class="analysis-content-card">
          <view class="analysis-item" wx:for="{{errorAnalysis}}" wx:key="index">
            <text class="analysis-point">• {{item}}</text>
          </view>
        </view>
      </view>

      <!-- 5. 底部操作按钮 - 重新设计布局和样式 -->
      <view class="action-buttons-section">
        <!-- 次要按钮：再听一遍 -->
        <view class="action-button secondary" bindtap="onPlayResultAudio">
          <view class="button-icon-circle">
            <text class="button-icon">🔊</text>
          </view>
          <text class="button-text">再听一遍</text>
        </view>
        <!-- 主要按钮：下一题 -->
        <view class="action-button primary" bindtap="onNextWord">
          <view class="button-icon-circle">
            <text class="button-icon">→</text>
          </view>
          <text class="button-text">下一题</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 练习统计 - 移除，不在主界面显示 -->
  <!-- 统计信息将在完成练习弹窗中显示 -->

  <!-- 练习完成弹窗 -->
  <view class="completion-overlay {{showCompletion ? 'show' : ''}}" catchtap="onHideCompletion">
    <view class="completion-popup" catchtap="stopPropagation">
      <!-- 1. 顶部状态区域 -->
      <view class="completion-status-section">
        <view class="completion-status-content">
          <view class="completion-status-icon">
            <text class="completion-icon-text">🏆</text>
          </view>
          <view class="completion-status-text">
            <text class="completion-status-title">拼写练习完成！</text>
            <text class="completion-status-subtitle">恭喜你完成了本次练习</text>
          </view>
        </view>
      </view>

      <!-- 2. 统计网格 - 重新设计布局 -->
      <view class="practice-stats-section">
        <view class="stats-grid">
          <view class="stat-item correct-stat">
            <text class="stat-value">{{practiceStats.correct}}</text>
            <text class="stat-label">正确数</text>
          </view>
          <view class="stat-item incorrect-stat">
            <text class="stat-value">{{practiceStats.incorrect}}</text>
            <text class="stat-label">错误数</text>
          </view>
          <view class="stat-item accuracy-stat">
            <text class="stat-value">{{practiceStats.accuracy}}%</text>
            <text class="stat-label">准确率</text>
          </view>
          <view class="stat-item time-stat">
            <text class="stat-value">{{practiceStats.timeUsed}}</text>
            <text class="stat-label">用时(分)</text>
          </view>
        </view>
      </view>

      <!-- 3. 成就徽章区域 -->
      <view class="achievement-section" wx:if="{{practiceStats.achievements.length > 0}}">
        <view class="achievement-header">
          <view class="achievement-icon-circle">
            <text class="achievement-icon">🏆</text>
          </view>
          <text class="achievement-title">获得成就</text>
        </view>
        <view class="achievement-badges-card">
          <view class="achievement-badge" wx:for="{{practiceStats.achievements}}" wx:key="index">
            <view class="badge-icon-circle">
              <text class="badge-icon">{{item.icon}}</text>
            </view>
            <text class="badge-name">{{item.name}}</text>
          </view>
        </view>
      </view>

      <!-- 4. 底部操作按钮 -->
      <view class="completion-action-buttons-section">
        <view class="completion-action-button secondary" bindtap="onRestartPractice">
          <text class="completion-button-text">🔄 重新开始</text>
        </view>
        <view class="completion-action-button primary" bindtap="onConfirmCompletion">
          <text class="completion-button-text">✔ 确认</text>
        </view>
        <view class="completion-action-button primary" bindtap="onBackToHome">
          <text class="completion-button-text">← 返回</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 帮助说明弹窗 -->
  <view class="help-overlay {{showHelp ? 'show' : ''}}" bindtap="onHideHelp">
    <view class="help-content" catchtap="stopPropagation">
      <view class="help-header">
        <text class="help-title">拼写练习说明</text>
        <view class="help-close-icon" bindtap="onHideHelp"><text>×</text></view>
      </view>
      <view class="help-body">
        <view class="help-item">
          <text class="help-step">1.</text>
          <text class="help-text">点击播放按钮听单词发音</text>
        </view>
        <view class="help-item">
          <text class="help-step">2.</text>
          <text class="help-text">根据发音和释义提示拼写单词</text>
        </view>
        <view class="help-item">
          <text class="help-step">3.</text>
          <text class="help-text">可以使用慢速播放和重复播放</text>
        </view>
        <view class="help-item">
          <text class="help-step">4.</text>
          <text class="help-text">需要帮助时可以点击提示按钮</text>
        </view>
        <view class="help-item">
          <text class="help-step">5.</text>
          <text class="help-text">完成拼写后点击提交查看结果</text>
        </view>
        <view class="help-actions">
          <view class="help-confirm-btn" bindtap="onHideHelp"><text>我知道了</text></view>
        </view>
      </view>
    </view>
  </view>
</view>