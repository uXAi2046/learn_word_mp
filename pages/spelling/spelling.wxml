<!--pages/spelling/spelling.wxml-->
<view class="spelling-container">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="back-btn" bindtap="onBack">
      <text class="back-icon">â†</text>
      <text>è¿”å›</text>
    </view>
    <view class="help-btn" bindtap="onShowHelp">
      <text>å¸®åŠ©</text>
    </view>
  </view>

  <!-- å­¦ä¹ è¿›åº¦ -->
  <view class="progress-section">
    <view class="progress-info">
      <text class="progress-text">{{currentIndex + 1}} / {{totalWords}}</text>
      <text class="progress-percentage">{{progressPercentage}}%</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progressPercentage}}%"></view>
    </view>
  </view>

  <!-- å•è¯å±•ç¤ºåŒºåŸŸ -->
  <view class="word-section">
    <view class="word-card">
      <!-- å•è¯æç¤º -->
      <view class="word-hint">
        <text class="hint-label">å•è¯æç¤ºï¼š</text>
        <text class="hint-text">{{currentWord.meaning}}</text>
      </view>

      <!-- éŸ³é¢‘æ’­æ”¾ -->
      <view class="audio-section">
        <view class="audio-btn {{isPlaying ? 'playing' : ''}}" bindtap="onPlayAudio">
          <text class="audio-icon">{{isPlaying ? 'â¸ï¸' : 'ğŸ”Š'}}</text>
        </view>
        <view class="audio-controls">
          <view class="control-btn" bindtap="onSlowPlay">
            <text>æ…¢é€Ÿ</text>
          </view>
          <view class="control-btn" bindtap="onRepeatPlay">
            <text>é‡å¤</text>
          </view>
        </view>
      </view>

      <!-- æ‹¼å†™è¾“å…¥åŒºåŸŸ -->
      <view class="spelling-input-section">
        <view class="input-container">
          <input 
            class="spelling-input {{inputStatus}}" 
            type="text" 
            placeholder="è¯·è¾“å…¥ä½ å¬åˆ°çš„å•è¯"
            value="{{userInput}}"
            bindinput="onInputChange"
            bindconfirm="onSubmitSpelling"
            focus="{{inputFocus}}"
            maxlength="{{currentWord.word.length + 5}}"
          />
          <view class="input-length">
            <text>{{userInput.length}} / {{currentWord.word.length}}</text>
          </view>
        </view>

        <!-- å­—æ¯æç¤º -->
        <view class="letter-hints" wx:if="{{showHints}}">
          <view class="hint-title">
            <text>å­—æ¯æç¤ºï¼š</text>
          </view>
          <view class="letter-grid">
            <view 
              class="letter-item {{item.revealed ? 'revealed' : ''}}" 
              wx:for="{{letterHints}}" 
              wx:key="index"
              bindtap="onRevealLetter"
              data-index="{{index}}"
            >
              <text>{{item.revealed ? item.letter : '?'}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <view class="action-btn secondary" bindtap="onShowHint" wx:if="{{!showHints}}">
          <text>ğŸ’¡ æç¤º</text>
        </view>
        <view class="action-btn secondary" bindtap="onSkipWord">
          <text>â­ï¸ è·³è¿‡</text>
        </view>
        <view class="action-btn primary" bindtap="onSubmitSpelling">
          <text>âœ“ æäº¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»“æœåé¦ˆ -->
  <view class="result-overlay {{showResult ? 'show' : ''}}" bindtap="onHideResult">
    <view class="result-content {{resultType}}" catchtap="stopPropagation">
      <view class="result-header">
        <text class="result-icon">{{resultType === 'correct' ? 'ğŸ‰' : 'ğŸ˜…'}}</text>
        <text class="result-title">{{resultType === 'correct' ? 'æ‹¼å†™æ­£ç¡®ï¼' : 'æ‹¼å†™é”™è¯¯'}}</text>
      </view>
      
      <view class="result-details">
        <view class="detail-item">
          <text class="detail-label">æ­£ç¡®ç­”æ¡ˆï¼š</text>
          <text class="detail-value correct">{{currentWord.word}}</text>
        </view>
        <view class="detail-item" wx:if="{{resultType === 'incorrect'}}">
          <text class="detail-label">ä½ çš„ç­”æ¡ˆï¼š</text>
          <text class="detail-value incorrect">{{userInput}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">éŸ³æ ‡ï¼š</text>
          <text class="detail-value">{{currentWord.phonetic}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">é‡Šä¹‰ï¼š</text>
          <text class="detail-value">{{currentWord.meaning}}</text>
        </view>
      </view>

      <!-- é”™è¯¯åˆ†æ -->
      <view class="error-analysis" wx:if="{{resultType === 'incorrect' && errorAnalysis.length > 0}}">
        <view class="analysis-title">
          <text>é”™è¯¯åˆ†æï¼š</text>
        </view>
        <view class="analysis-list">
          <view class="analysis-item" wx:for="{{errorAnalysis}}" wx:key="index">
            <text class="analysis-text">{{item}}</text>
          </view>
        </view>
      </view>

      <view class="result-actions">
        <view class="result-btn secondary" bindtap="onPlayResultAudio">
          <text>ğŸ”Š å†å¬ä¸€é</text>
        </view>
        <view class="result-btn primary" bindtap="onNextWord">
          <text>{{currentIndex < totalWords - 1 ? 'ä¸‹ä¸€ä¸ª' : 'å®Œæˆç»ƒä¹ '}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»ƒä¹ ç»Ÿè®¡ - ç§»é™¤ï¼Œä¸åœ¨ä¸»ç•Œé¢æ˜¾ç¤º -->
  <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨å®Œæˆç»ƒä¹ å¼¹çª—ä¸­æ˜¾ç¤º -->

  <!-- å®Œæˆç»ƒä¹ å¼¹çª— -->
  <view class="complete-overlay {{showComplete ? 'show' : ''}}" bindtap="onHideComplete">
    <view class="complete-content" catchtap="stopPropagation">
      <view class="complete-header">
        <text class="complete-icon">ğŸ†</text>
        <text class="complete-title">æ‹¼å†™ç»ƒä¹ å®Œæˆï¼</text>
      </view>
      
      <view class="complete-stats">
        <view class="complete-stat-row">
          <view class="complete-stat">
            <text class="complete-stat-value">{{stats.correct}}</text>
            <text class="complete-stat-label">æ­£ç¡®</text>
          </view>
          <view class="complete-stat">
            <text class="complete-stat-value">{{stats.incorrect}}</text>
            <text class="complete-stat-label">é”™è¯¯</text>
          </view>
        </view>
        <view class="complete-stat-row">
          <view class="complete-stat">
            <text class="complete-stat-value">{{stats.accuracy}}%</text>
            <text class="complete-stat-label">å‡†ç¡®ç‡</text>
          </view>
          <view class="complete-stat">
            <text class="complete-stat-value">{{practiceTime}}</text>
            <text class="complete-stat-label">ç”¨æ—¶(åˆ†é’Ÿ)</text>
          </view>
        </view>
      </view>

      <!-- æˆå°±å¾½ç«  -->
      <view class="achievement-section" wx:if="{{achievements.length > 0}}">
        <view class="achievement-title">
          <text>è·å¾—æˆå°±ï¼š</text>
        </view>
        <view class="achievement-list">
          <view class="achievement-item" wx:for="{{achievements}}" wx:key="index">
            <text class="achievement-icon">{{item.icon}}</text>
            <text class="achievement-name">{{item.name}}</text>
          </view>
        </view>
      </view>

      <view class="complete-actions">
        <view class="complete-btn secondary" bindtap="onRestart">
          <text>é‡æ–°ç»ƒä¹ </text>
        </view>
        <view class="complete-btn primary" bindtap="onBackToDetail">
          <text>è¿”å›è¯¦æƒ…</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¸®åŠ©è¯´æ˜å¼¹çª— -->
  <view class="help-overlay {{showHelp ? 'show' : ''}}" bindtap="onHideHelp">
    <view class="help-content" catchtap="stopPropagation">
      <view class="help-header">
        <text class="help-title">æ‹¼å†™ç»ƒä¹ è¯´æ˜</text>
        <text class="help-close" bindtap="onHideHelp">Ã—</text>
      </view>
      <view class="help-body">
        <view class="help-item">
          <text class="help-step">1.</text>
          <text class="help-text">ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¬å•è¯å‘éŸ³</text>
        </view>
        <view class="help-item">
          <text class="help-step">2.</text>
          <text class="help-text">æ ¹æ®å‘éŸ³å’Œé‡Šä¹‰æç¤ºæ‹¼å†™å•è¯</text>
        </view>
        <view class="help-item">
          <text class="help-step">3.</text>
          <text class="help-text">å¯ä»¥ä½¿ç”¨æ…¢é€Ÿæ’­æ”¾å’Œé‡å¤æ’­æ”¾</text>
        </view>
        <view class="help-item">
          <text class="help-step">4.</text>
          <text class="help-text">éœ€è¦å¸®åŠ©æ—¶å¯ä»¥ç‚¹å‡»æç¤ºæŒ‰é’®</text>
        </view>
        <view class="help-item">
          <text class="help-step">5.</text>
          <text class="help-text">å®Œæˆæ‹¼å†™åç‚¹å‡»æäº¤æŸ¥çœ‹ç»“æœ</text>
        </view>
      </view>
    </view>
  </view>
</view>