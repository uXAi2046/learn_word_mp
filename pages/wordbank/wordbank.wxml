<!--pages/wordbank/wordbank.wxml-->
<view class="wordbank-container">
  <!-- é¡¶éƒ¨æœç´¢å’Œç­›é€‰ -->
  <view class="header-section">
    <!-- å­¦ä¹ è¿›åº¦å¡ç‰‡ -->
    <view class="progress-card">
      <view class="progress-header">
        <text class="progress-icon">ğŸ“Š</text>
        <text class="progress-title">ä»Šæ—¥å­¦ä¹ è¿›åº¦</text>
      </view>
      <view class="progress-content">
        <view class="progress-stats">
          <text class="progress-text">ç›®æ ‡: {{todayTarget}}ä¸ªå•è¯</text>
          <text class="progress-text">å·²å­¦: {{todayLearned}}ä¸ª</text>
          <text class="progress-text">å‰©ä½™: {{todayTarget - todayLearned}}ä¸ª</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayProgress}}%"></view>
        </view>
        <text class="progress-percent">{{todayProgress}}%</text>
      </view>
    </view>

    <!-- æœç´¢æ  -->
    <view class="search-section">
      <view class="search-bar">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input" 
          placeholder="æœç´¢å•è¯ã€é‡Šä¹‰ã€ä¾‹å¥..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
        />
        <text 
          wx:if="{{searchKeyword}}" 
          class="clear-search" 
          bindtap="clearSearch"
        >âœ•</text>
      </view>
      <view class="filter-btn" bindtap="toggleFilters">
        <text class="filter-icon">âš™ï¸</text>
        <text class="filter-text">ç­›é€‰</text>
        <text wx:if="{{showFilters}}" class="filter-arrow">â–²</text>
        <text wx:else class="filter-arrow">â–¼</text>
      </view>
    </view>

    <!-- ç­›é€‰å™¨ -->
    <view class="filters-section" wx:if="{{showFilters}}">
      <view class="filter-row">
        <text class="filter-label">æ•™æç‰ˆæœ¬:</text>
        <picker 
          range="{{textbookOptions}}" 
          value="{{textbookOptions.indexOf(selectedTextbook)}}"
          bindchange="onTextbookChange"
        >
          <view class="filter-picker">{{selectedTextbook}} â–¼</view>
        </picker>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">å¹´çº§:</text>
        <picker 
          range="{{gradeOptions}}" 
          value="{{gradeOptions.indexOf(selectedGrade)}}"
          bindchange="onGradeChange"
        >
          <view class="filter-picker">{{selectedGrade}} â–¼</view>
        </picker>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">å•å…ƒ:</text>
        <picker 
          range="{{unitOptions}}" 
          value="{{unitOptions.indexOf(selectedUnit)}}"
          bindchange="onUnitChange"
        >
          <view class="filter-picker">{{selectedUnit}} â–¼</view>
        </picker>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">é‡è¦ç¨‹åº¦:</text>
        <picker 
          range="{{importanceOptions}}" 
          value="{{importanceOptions.indexOf(selectedImportance)}}"
          bindchange="onImportanceChange"
        >
          <view class="filter-picker">{{selectedImportance}} â–¼</view>
        </picker>
      </view>
      
      <!-- ç­›é€‰å™¨æ“ä½œæŒ‰é’® -->
      <view class="filter-actions">
        <view class="filter-action-btn reset-btn" bindtap="resetFilters">
          <text class="action-text">é‡ç½®</text>
        </view>
        <view class="filter-action-btn apply-btn" bindtap="applyFilters">
          <text class="action-text">åº”ç”¨</text>
        </view>
      </view>
    </view>

    <!-- å·¥å…·æ  -->
    <view class="toolbar">
      <view class="display-mode">
        <text 
          class="mode-btn {{displayMode === 'list' ? 'active' : ''}}"
          bindtap="toggleDisplayMode"
        >åˆ—è¡¨</text>
        <text 
          class="mode-btn {{displayMode === 'card' ? 'active' : ''}}"
          bindtap="toggleDisplayMode"
        >å¡ç‰‡</text>
      </view>
      
      <view class="sort-options">
        <text class="sort-label">æ’åº:</text>
        <text 
          class="sort-btn {{sortBy === 'textbook' ? 'active' : ''}}"
          data-sort="textbook"
          bindtap="onSortChange"
        >æ•™æ</text>
        <text 
          class="sort-btn {{sortBy === 'alphabet' ? 'active' : ''}}"
          data-sort="alphabet"
          bindtap="onSortChange"
        >å­—æ¯</text>
        <text 
          class="sort-btn {{sortBy === 'importance' ? 'active' : ''}}"
          data-sort="importance"
          bindtap="onSortChange"
        >é‡è¦åº¦</text>
        <text 
          class="sort-btn {{sortBy === 'favorite' ? 'active' : ''}}"
          data-sort="favorite"
          bindtap="onSortChange"
        >æ”¶è—</text>
      </view>
    </view>
  </view>

  <!-- å•è¯åˆ—è¡¨ -->
  <view class="word-list">
    <!-- åˆ—è¡¨æ¨¡å¼ -->
    <view wx:if="{{displayMode === 'list'}}" class="list-mode">
      <view 
        wx:for="{{filteredWordList}}" 
        wx:key="id"
        class="word-item-list"
        data-id="{{item.id}}"
        bindtap="viewWordDetail"
      >
        <view class="word-main">
          <view class="word-header">
            <text class="word-text">{{item.word}}</text>
            <text class="word-pronunciation">ğŸ”Š</text>
            <text 
              class="favorite-btn {{item.isFavorite ? 'favorited' : ''}}"
              data-id="{{item.id}}"
              catchtap="toggleFavorite"
            >{{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          </view>
          
          <view class="word-info">
            <text class="word-pos">{{item.partOfSpeech}}</text>
            <text class="word-translation">{{item.translation}}</text>
          </view>
          
          <view class="word-meta">
            <text class="word-source">{{item.textbook}} {{item.grade}} {{item.unit}}</text>
            <text class="importance-tag importance-{{item.importance === 'å¿…è€ƒ' ? 'required' : item.importance === 'å¸¸è€ƒ' ? 'common' : 'understand'}}">{{item.importance}}</text>
            <text class="mastery-level">ç†Ÿç»ƒåº¦: {{item.masteryLevel}}%</text>
            <text class="last-review">ä¸Šæ¬¡å¤ä¹ : {{item.lastReviewTime}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¡ç‰‡æ¨¡å¼ -->
    <view wx:if="{{displayMode === 'card'}}" class="card-mode">
      <view 
        wx:for="{{filteredWordList}}" 
        wx:key="id"
        class="word-item-card"
        data-id="{{item.id}}"
        bindtap="viewWordDetail"
      >
        <view class="card-header">
          <view class="word-title">
            <text class="word-text">{{item.word}}</text>
            <text class="word-pronunciation">ğŸ”Š</text>
          </view>
          <text 
            class="favorite-btn {{item.isFavorite ? 'favorited' : ''}}"
            data-id="{{item.id}}"
            catchtap="toggleFavorite"
          >{{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        </view>
        
        <view class="card-content">
          <view class="word-meaning">
            <text class="word-pos">{{item.partOfSpeech}}</text>
            <text class="word-translation">{{item.translation}}</text>
          </view>
          
          <view class="word-example" wx:if="{{item.exampleSentence}}">
            <text class="example-label">ğŸ“ ä¾‹å¥:</text>
            <text class="example-text">{{item.exampleSentence}}</text>
            <text class="example-translation">{{item.exampleTranslation}}</text>
          </view>
        </view>
        
        <view class="card-footer">
          <view class="word-tags">
            <text class="source-tag">{{item.textbook}}</text>
            <text class="grade-tag">{{item.grade}}</text>
            <text class="importance-tag importance-{{item.importance === 'å¿…è€ƒ' ? 'required' : item.importance === 'å¸¸è€ƒ' ? 'common' : 'understand'}}">{{item.importance}}</text>
          </view>
          
          <view class="mastery-info">
            <text class="mastery-text">ç†Ÿç»ƒåº¦: {{item.masteryLevel}}%</text>
            <view class="mastery-bar">
              <view class="mastery-fill" style="width: {{item.masteryLevel}}%"></view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{filteredWordList.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“–</text>
      <text class="empty-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„å•è¯</text>
      <text class="empty-desc">è¯•è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>