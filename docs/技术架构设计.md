# 英语单词背诵小程序 - 技术架构设计

## 1. 技术选型

### 1.1 前端框架
- **微信小程序原生框架**
  - WXML：页面结构
  - WXSS：样式设计
  - JavaScript：业务逻辑
  - JSON：页面配置

### 1.2 后端服务
- **微信小程序云开发**
  - 云函数：业务逻辑处理
  - 云数据库：数据存储
  - 云存储：静态资源存储
  - 云托管：可选的容器化部署

### 1.3 数据库设计
- **云数据库（MongoDB）**
  - 文档型数据库，适合小程序开发
  - 支持复杂查询和索引
  - 自动扩容和备份

## 2. 项目目录结构

```
learn_english/
├── docs/                          # 文档目录
│   ├── PRD.md                     # 产品需求文档
│   ├── 技术架构设计.md              # 技术架构文档
│   ├── 开发任务拆解.md              # 任务拆解文档
│   └── 开发计划.md                 # 开发计划
├── miniprogram/                   # 小程序前端代码
│   ├── pages/                     # 页面目录
│   │   ├── index/                 # 首页
│   │   │   ├── index.js
│   │   │   ├── index.json
│   │   │   ├── index.wxml
│   │   │   └── index.wxss
│   │   ├── quiz/                  # 答题模式
│   │   │   ├── quiz-home/         # 答题首页
│   │   │   ├── quiz-progress/     # 答题进行中
│   │   │   ├── quiz-result/       # 答题结果
│   │   │   └── quiz-settings/     # 答题设置
│   │   ├── wordbank/              # 单词库
│   │   │   ├── wordbank-list/     # 单词列表
│   │   │   ├── wordbank-detail/   # 单词详情
│   │   │   └── wordbank-search/   # 单词搜索
│   │   ├── knowledge/             # 知识点
│   │   │   ├── knowledge-list/    # 知识点列表
│   │   │   └── knowledge-detail/  # 知识点详情
│   │   └── profile/               # 个人中心
│   │       ├── profile-home/      # 个人首页
│   │       ├── profile-stats/     # 学习统计
│   │       ├── profile-errors/    # 错题库
│   │       └── profile-settings/  # 设置页面
│   ├── components/                # 自定义组件
│   │   ├── question-card/         # 题目卡片组件
│   │   ├── word-card/             # 单词卡片组件
│   │   ├── progress-bar/          # 进度条组件
│   │   ├── filter-panel/          # 筛选面板组件
│   │   └── stats-chart/           # 统计图表组件
│   ├── utils/                     # 工具函数
│   │   ├── api.js                 # API接口封装
│   │   ├── storage.js             # 本地存储工具
│   │   ├── format.js              # 数据格式化工具
│   │   └── constants.js           # 常量定义
│   ├── styles/                    # 全局样式
│   │   ├── common.wxss            # 通用样式
│   │   └── theme.wxss             # 主题样式
│   ├── images/                    # 图片资源
│   ├── app.js                     # 小程序入口文件
│   ├── app.json                   # 小程序配置文件
│   ├── app.wxss                   # 全局样式文件
│   └── sitemap.json               # 搜索配置文件
├── cloudfunctions/                # 云函数目录
│   ├── getWords/                  # 获取单词列表
│   ├── submitAnswer/              # 提交答案
│   ├── getQuizData/               # 获取答题数据
│   ├── updateUserStats/           # 更新用户统计
│   └── getKnowledge/              # 获取知识点
├── database/                      # 数据库设计
│   ├── collections.md             # 数据集合设计
│   └── indexes.md                 # 索引设计
└── README.md                      # 项目说明文档
```

## 3. 数据库设计

### 3.1 数据集合结构

#### 3.1.1 单词集合 (words)
```javascript
{
  _id: "word_id",
  word: "example",              // 英文单词
  translation: "例子",          // 中文释义
  partOfSpeech: "noun",         // 词性
  exampleSentence: "This is an example.", // 例句
  source: "Oxford Dictionary",   // 来源
  difficultyLevel: 3,           // 难度级别 1-5
  createdTime: Date,            // 创建时间
  updatedTime: Date             // 更新时间
}
```

#### 3.1.2 用户集合 (users)
```javascript
{
  _id: "user_id",
  openid: "wx_openid",          // 微信openid
  nickname: "用户昵称",          // 昵称
  avatar: "avatar_url",         // 头像URL
  totalQuestions: 0,            // 总答题数
  correctAnswers: 0,            // 正确答题数
  totalStudyTime: 0,            // 总学习时长(分钟)
  studyDays: 0,                 // 学习天数
  lastStudyDate: Date,          // 最后学习日期
  createdTime: Date,            // 注册时间
  settings: {                   // 用户设置
    reminderEnabled: true,
    reminderTime: "20:00"
  }
}
```

#### 3.1.3 答题记录集合 (quiz_records)
```javascript
{
  _id: "record_id",
  userId: "user_id",            // 用户ID
  quizType: "quick",            // 答题类型: quick/endless
  totalQuestions: 30,           // 总题数
  correctAnswers: 25,           // 正确数
  accuracy: 83.33,              // 正确率
  duration: 600,                // 用时(秒)
  startTime: Date,              // 开始时间
  endTime: Date,                // 结束时间
  questions: [                  // 题目详情
    {
      wordId: "word_id",
      questionType: "choice",   // choice/fill
      userAnswer: "example",
      correctAnswer: "example",
      isCorrect: true,
      timeSpent: 5              // 单题用时(秒)
    }
  ]
}
```

#### 3.1.4 错题集合 (error_words)
```javascript
{
  _id: "error_id",
  userId: "user_id",            // 用户ID
  wordId: "word_id",            // 单词ID
  errorCount: 3,                // 错误次数
  lastErrorTime: Date,          // 最后错误时间
  isResolved: false             // 是否已掌握
}
```

#### 3.1.5 知识点集合 (knowledge)
```javascript
{
  _id: "knowledge_id",
  title: "动词变化规则",         // 标题
  category: "grammar",          // 分类
  content: "详细内容...",        // 内容
  examples: ["例子1", "例子2"],  // 示例
  tags: ["动词", "语法"],        // 标签
  order: 1,                     // 排序
  createdTime: Date
}
```

### 3.2 数据库索引设计
```javascript
// words集合索引
db.words.createIndex({ "word": 1 })
db.words.createIndex({ "source": 1 })
db.words.createIndex({ "difficultyLevel": 1 })
db.words.createIndex({ "partOfSpeech": 1 })

// users集合索引
db.users.createIndex({ "openid": 1 }, { unique: true })

// quiz_records集合索引
db.quiz_records.createIndex({ "userId": 1, "startTime": -1 })

// error_words集合索引
db.error_words.createIndex({ "userId": 1, "isResolved": 1 })
db.error_words.createIndex({ "userId": 1, "wordId": 1 }, { unique: true })
```

## 4. 核心功能架构

### 4.1 答题系统架构
```
用户选择答题模式 → 云函数生成题目 → 前端展示题目 → 用户答题 → 云函数校验答案 → 更新统计数据
```

### 4.2 单词库系统架构
```
前端请求 → 云函数查询 → 数据库筛选 → 分页返回 → 前端展示 → 本地缓存
```

### 4.3 用户数据同步架构
```
用户操作 → 本地存储 → 云函数同步 → 云数据库 → 实时更新
```

## 5. 性能优化策略

### 5.1 前端优化
- **分包加载**：按功能模块分包，减少首次加载时间
- **图片优化**：使用WebP格式，实现懒加载
- **数据缓存**：常用数据本地缓存，减少网络请求
- **组件复用**：抽象通用组件，提高开发效率

### 5.2 后端优化
- **数据库索引**：为常用查询字段建立索引
- **分页查询**：大数据量分页加载
- **缓存策略**：热点数据云端缓存
- **并发控制**：限制并发请求数量

### 5.3 用户体验优化
- **离线功能**：核心功能支持离线使用
- **加载状态**：友好的加载提示
- **错误处理**：完善的错误提示和重试机制
- **响应式设计**：适配不同屏幕尺寸

## 6. 安全性设计

### 6.1 数据安全
- **权限控制**：基于用户身份的数据访问控制
- **数据加密**：敏感数据传输和存储加密
- **输入验证**：前后端双重数据验证
- **SQL注入防护**：使用参数化查询

### 6.2 接口安全
- **身份验证**：基于微信登录的用户身份验证
- **请求限制**：API调用频率限制
- **数据脱敏**：敏感信息脱敏处理
- **日志监控**：异常操作日志记录

## 7. 部署和运维

### 7.1 部署流程
1. 代码提交到版本控制系统
2. 云函数自动部署
3. 数据库迁移和初始化
4. 小程序代码上传和审核
5. 正式发布

### 7.2 监控和维护
- **性能监控**：页面加载时间、API响应时间
- **错误监控**：异常日志收集和分析
- **用户行为分析**：用户使用数据统计
- **定期备份**：数据库定期备份和恢复测试